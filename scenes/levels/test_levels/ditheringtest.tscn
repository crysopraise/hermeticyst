[gd_scene load_steps=5 format=2]

[ext_resource path="res://assets/dither map 8x8.png" type="Texture" id=1]
[ext_resource path="res://scenes/levels/meleeguys.tscn" type="PackedScene" id=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;
render_mode unshaded;

uniform sampler2D dither_pattern;
uniform bool enabled = true;
uniform bool greyscale = false;
uniform float dither_amount = 1.0;
uniform int colours = 4;

float dither(float raw, float dither, int depth) {
	
	float div = 1.0 / float(depth);
	float val = 0.0;
	
	for (int i = 0; i < depth; i++) {
		if (raw <= div * (float(i + 1))) {
			if ((raw * float(depth)) - float(i) <= dither * 0.999) 	{val = div * float(i);}
			else													{val = div * float(i + 1);}
			break;
		}
	}

	return val;
}

void fragment() {
	COLOR = texture(TEXTURE, SCREEN_UV);
//	vec4 raw = texture(TEXTURE, SCREEN_UV);
//	vec3 dither_pixel = texture(dither_pattern, SCREEN_UV).rgb;
//	if (enabled == true) {
//
//		if (greyscale == true) {
//			raw.rgb = vec3((raw.r + raw.g + raw.b) / 3.0);
//		}
//
//		COLOR.r = dither(raw.r, (dither_pixel.x - 0.5) * dither_amount + 0.5, colours - 1);
//		COLOR.g  = dither(raw.g, (dither_pixel.x - 0.5) * dither_amount + 0.5, colours - 1);
//		COLOR.b = dither(raw.b, (dither_pixel.x - 0.5) * dither_amount + 0.5, colours - 1);
//
//	} else {
//		COLOR.rgb = raw.rgb;
//	}
	

}
"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/enabled = true
shader_param/greyscale = false
shader_param/dither_amount = 0.9
shader_param/colours = 4
shader_param/dither_pattern = ExtResource( 1 )

[node name="Node2D" type="Node2D"]

[node name="ViewportContainer" type="ViewportContainer" parent="."]
material = SubResource( 2 )
margin_right = 1024.0
margin_bottom = 600.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Viewport" type="Viewport" parent="ViewportContainer"]
size = Vector2( 1024, 600 )
handle_input_locally = false
hdr = false
render_target_update_mode = 3
shadow_atlas_size = 8192

[node name="MeleeGuys" parent="ViewportContainer/Viewport" instance=ExtResource( 2 )]
